<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>day1.py</title>
  <link rel="stylesheet" href="../pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>day1.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <h3><span id="day1-ideas-covered" href="day1-ideas-covered"> Day1 Ideas covered </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <ol>
<li>dev env deployment - <strong> docker </strong></li>
<li>dev env - <strong> docker-compose </strong></li>
<li>dev env integration - <strong> docker-compose </strong></li>
<li>dev tool - for this static site we use <strong> pycco </strong> to generate html</li>
<li>delivery  - we publish the html site to <strong> aws s3 </strong></li>
<li>version ctrl - <strong> github </strong>, we might use aws CodeCommit, etc</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <h3><span id="day1-section-1" href="day1-section-1"> Day1 Section 1 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>minimal Dockerfile nginx alpine</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Dockerfile</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">FROM</span> <span class="n">nginx</span><span class="p">:</span><span class="mf">1.15</span><span class="o">-</span><span class="n">alpine</span>
    <span class="n">RUN</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span>
    <span class="n">COPY</span> <span class="n">output</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>run command
src: https://hub.docker.com/_/nginx/</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">static</span><span class="o">-</span><span class="n">nginx</span> <span class="o">.</span>
    <span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">day1</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">80</span> <span class="n">static</span><span class="o">-</span><span class="n">nginx</span>
    <span class="n">docker</span> <span class="n">stop</span> <span class="n">day1</span>
  
    <span class="n">docker</span> <span class="n">build</span>
                            <span class="o">-</span><span class="n">t</span> <span class="n">tag</span>      <span class="c1"># add tag as image name</span>
    <span class="n">docker</span> <span class="n">run</span>
                            <span class="o">-</span><span class="n">p</span> <span class="mi">8080</span><span class="p">:</span><span class="mi">80</span>  <span class="c1"># mapping container 80 to host 8080</span>
                            <span class="o">-</span><span class="n">d</span>          <span class="c1"># run detached</span>
                            <span class="o">--</span><span class="n">name</span>      <span class="c1"># container name</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>use docker-compose to build and run</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span>
                        <span class="o">--</span><span class="n">build</span>         <span class="c1"># build if no container</span>
                        <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">recreate</span>   <span class="c1"># if there is container, do not recreate it</span>

    <span class="nb">open</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span>          <span class="c1"># local test</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <h3><span id="day1-section-2" href="day1-section-2"> Day1 Section 2 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>docker-compose</p>
<p>if not specify image it will use <project>_<service> as container name</p>
<p>with already built image, you can remove [build] from docker-compose.yml
add the specified image and container name</p>
<pre><code>image: my_custom_nginx_image
container_name: nginx
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">docker</span> <span class="n">image</span> <span class="n">image_id</span> <span class="n">tag</span> <span class="n">image_name</span>
    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <h3><span id="day1-section-3" href="day1-section-3"> Day1 Section 3 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <ol>
<li><strong> docker </strong> - use docker cmd to clean up</li>
<li><strong> docker-compose </strong> - stop and/or cleanup</li>
</ol>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">docker</span> <span class="n">container</span> <span class="n">rm</span> <span class="n">container_name</span>
    <span class="n">docker</span> <span class="n">image</span> <span class="n">rm</span> <span class="n">image_name</span>
                            <span class="o">-</span><span class="n">f</span>      <span class="c1"># force</span>
    <span class="n">docker</span> <span class="n">image</span> <span class="n">prune</span>              <span class="c1"># remove unused images</span>
    <span class="n">docker</span> <span class="n">images</span>

    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">ps</span>
    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">stop</span>
                            <span class="n">stop</span>    <span class="c1"># stop all containers</span>
                            <span class="n">rm</span> <span class="o">-</span><span class="n">f</span>   <span class="c1"># remove all containers</span>
    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span> <span class="o">--</span><span class="n">rmi</span> <span class="nb">all</span>
                            <span class="n">down</span>    <span class="c1"># stop and remove containers networks, volumes and images</span>

    <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <h3><span id="day1-section-4" href="day1-section-4"> Day1 Section 4 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>generate document from pyfile</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">pip</span> <span class="n">install</span> <span class="n">pycco</span>
    <span class="n">pycco</span> <span class="n">docker_day1</span><span class="o">/*.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="n">html_output</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">i</span>
                            <span class="o">-</span><span class="n">p</span>  <span class="c1"># preservce path</span>
                            <span class="o">-</span><span class="n">d</span>  <span class="c1"># output directory</span>
                            <span class="o">-</span><span class="n">i</span>  <span class="c1"># generate index</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>local test</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="mi">8000</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <h3><span id="day1-section-5" href="day1-section-5"> Day1 Section 5 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>use aws s3 to host the site</p>
<ul>
<li>
<p>currently use google domain 301 redirect to serve the files</p>
</li>
<li>
<p><a href="http://2018-test-bucket-andydocket.s3-website.us-west-1.amazonaws.com/assets/aws_website-policy.json">aws_website-policy.json</a></p>
</li>
<li><a href="http://2018-test-bucket-andydocket.s3-website.us-west-1.amazonaws.com/assets/aws_website.json">aws_website.json</a></li>
</ul>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="o">*</span> <span class="n">init</span>

<span class="n">aws</span> <span class="n">s3</span> <span class="n">mb</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="mi">2018</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">andydocket</span>
<span class="n">aws</span> <span class="n">s3api</span> <span class="n">put</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">policy</span> <span class="o">--</span><span class="n">bucket</span> <span class="mi">2018</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">andydocket</span> \
    <span class="o">--</span><span class="n">policy</span> <span class="nb">file</span><span class="p">:</span><span class="o">//</span><span class="n">assets</span><span class="o">/</span><span class="n">aws_website</span><span class="o">-</span><span class="n">policy</span><span class="o">.</span><span class="n">json</span>
<span class="n">aws</span> <span class="n">s3api</span> <span class="n">put</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">website</span> <span class="o">--</span><span class="n">bucket</span> <span class="mi">2018</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">andydocket</span> \
    <span class="o">--</span><span class="n">website</span><span class="o">-</span><span class="n">configuration</span> <span class="nb">file</span><span class="p">:</span><span class="o">//</span><span class="n">assets</span><span class="o">/</span><span class="n">aws_website</span><span class="o">.</span><span class="n">json</span>

<span class="o">*</span> <span class="n">update</span>

<span class="n">aws</span> <span class="n">s3</span> <span class="n">sync</span> <span class="n">html_output</span><span class="o">/</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="mi">2018</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">andydocket</span>
<span class="n">aws</span> <span class="n">s3</span> <span class="n">sync</span> <span class="n">assets</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="mi">2018</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">bucket</span><span class="o">-</span><span class="n">andydocket</span><span class="o">/</span><span class="n">assets</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <h3><span id="day1-section-6" href="day1-section-6"> Day1 Section 6 </span></h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>sync with github</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">github</span> <span class="n">git</span><span class="nd">@github.com</span><span class="p">:</span><span class="n">arbeitandy</span><span class="o">/</span><span class="n">mywaytoday</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">pull</span> <span class="n">github</span> <span class="n">master</span> <span class="o">--</span><span class="n">allow</span><span class="o">-</span><span class="n">unrelated</span><span class="o">-</span><span class="n">histories</span>

<span class="n">git</span> <span class="n">push</span> <span class="n">github</span> <span class="n">master</span> <span class="o">--</span><span class="nb">all</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>made by <a href="https://pycco-docs.github.io/pycco/">Pycco</a></p>
<p><a href="http://d.fogtown.us/">Home</a></p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
